(function(m,n){function e(a){if(a!==true){G(this,a||{});this.element=this.getElement()}}function o(a,b){if(a!==true){this.components=[];e.call(this,b||{});Object.isArray(a)&&a.each(this.addComponent,this);this.__shouldUpdateComponents=this.__needsRender=true}}function v(a,b){o.call(this,a,b);this.__shouldUpdateComponents=this.__needsRender=false}function q(a){e.call(this,a);this._t="";this._n=n.createTextNode(this._t);this.element.appendChild(this._n)}function w(a,b){this.spriteset=a;this.spritesetImg=
a.image.cloneNode(false);e.call(this,b)}function A(a){e.call(this,a)}function E(a){e.call(this,a)}function h(a){if(!a){this._l={};if(!(this instanceof h))for(var b in h.prototype)this[b]=h.prototype[b]}}function k(a){h.call(this);this.game=a;this._k={}}function H(a){var b=f.game.screen.element.cumulativeOffset();return{x:a.pointerX()-b.left,y:a.pointerY()-b.top}}function W(a){if(f){var b=H(a),d=f.game.screen;b.x>=0&&b.y>=0&&b.x<=d.width&&b.y<=d.height&&a.stop()}}function X(a){a.ctrlKey||a.metaKey||
a.altKey||f&&a.stop()}function Y(a){if(!(a.ctrlKey||a.metaKey||a.altKey))if(f){a.stop();if(f._k[a.keyCode]!==true){var b={keyCode:a.keyCode,shiftKey:a.shiftKey};f._k[a.keyCode]=true;f.fireEvent("keydown",[b])}}}function Z(a){if(!(a.ctrlKey||a.metaKey||a.altKey))if(f){a.stop();if(f._k[a.keyCode]!==false){var b={keyCode:a.keyCode,shiftKey:a.shiftKey};f._k[a.keyCode]=false;f.fireEvent("keydown",[b])}}}function I(a){if(f){var b=H(a),d=f.game.screen;b.button=a.button;if(b.x>=0&&b.y>=0&&b.x<=d.width&&b.y<=
d.height){f=f;a.stop();m.focus();f.pointerX=b.x;f.pointerY=b.y;f.fireEvent("mousedown",[b])}else{f=null;I(a)}}else{b=J.length;for(var c=d=null,g=a.pointerX(),p=a.pointerY();b--;){c=J[b].screen.element;d=c.cumulativeOffset();if(g>=d.left&&g<=d.left+c.clientWidth&&p>=d.top&&p<=d.top+c.clientHeight){f=J[b].input;I(a)}}}}function aa(a){if(f){var b=H(a),d=f.game.screen;b.button=a.button;if(b.x>=0&&b.y>=0&&b.x<=d.width&&b.y<=d.height){a.stop();f.pointerX=b.x;f.pointerY=b.y;f.fireEvent("mouseup",[b])}}}
function ba(a){if(f){var b=H(a),d=f.game.screen;if(b.x>=0&&b.y>=0&&b.x<=d.width&&b.y<=d.height&&(f.pointerX!==b.x||f.pointerY!==b.y)){a.stop();f.pointerX=b.x;f.pointerY=b.y;f.fireEvent("mousemove",[b])}}}function l(a,b,d){var c=this;h.call(c);o.call(c,d);c.input=new k(c);c.screen=new B(c);c.screen._bind(b);if(a.endsWith("main.js"))a=a.substring(0,a.lastIndexOf("main.js"));c.root=a.endsWith("/")?a:a+"/";c.setGameSpeed(c.gameSpeed);c.loaded=c.running=false;c.startTime=NaN;K=c;c._s=function(){c.step()};
new t(c,"main.js",function(){c.loaded=true;c.fireEvent("load");c.start()})}function F(a,b){h.call(this);if(a instanceof l){b=a.root+b;this.__fontName="SGF_font"+(Math.random()*1E4).round();var d='@font-face {  font-family: "'+this.__fontName+'";  src: url("'+b+'");}',c=n.createElement("style");c.type="text/css";if(c.styleSheet)c.styleSheet.cssText=d;else c.appendChild(n.createTextNode(d));n.getElementsByTagName("head")[0].appendChild(c);this.__styleNode=c}else this.__fontName=b=a}function t(a,b,d){if(a instanceof
l)b=a.root+b;else{d=b;b=a}var c=n.createElement("script"),g=this;h.call(g);d&&g.addListener("load",d);c.type="text/javascript";c.setAttribute("async","true");c.onload=c.onreadystatechange=function(){if(!c.readyState||c.readyState=="loaded"||c.readyState=="complete")g.fireEvent("load")};c.src=b;n.getElementsByTagName("head")[0].appendChild(c)}function u(a,b,d,c,g){var p=this;h.call(p);p.spriteWidth=d;p.spriteHeight=c;g&&p.addListener("load",g);var x=new Image;x.style.position="absolute";x.onload=function(){p.width=
x.width;p.height=x.height;p.loaded=true;p.fireEvent("load")};p.image=x;p.src=x.src=a.root+b}function y(a,b){h.call(this);G(this,b||{});this.URL=a;this._O=P(pa,this);this._C=P(qa,this);this._M=P(ra,this);this.autoconnect&&this.connect()}function pa(){this.fireEvent("open")}function qa(){this.fireEvent("close");this._w=null}function ra(a){this.fireEvent("message",a.data)}function ca(){throw Error("The HTML game engine is not capable of starting a `Server`.");}function da(a,b){if(typeof a==="function")try{0()}catch(d){da(d,
a)}else{var c=a.stack;if(a.sourceURL)b(a.sourceURL);else if(a.arguments){c=c.split("\n")[2];c=c.substring(c.lastIndexOf(" ")+1);c=c.substring(0,c.lastIndexOf(":"));if(c.indexOf("(")===0)c=c.substring(1);b(c.substring(0,c.lastIndexOf(":")))}else if(c){c=c.split("\n")[0];c=c.substring(c.indexOf("@")+1);b(c.substring(0,c.lastIndexOf(":")))}else{var g=m.onerror;m.onerror=function(p,x){m.onerror=g;b(x);return true};throw a;}}}function L(){if(ea()&&fa()&&ga()&&"WebSocket"in m){k.grab();if(s.game)s.screen?
Q(s.game,s.screen):ha(s.game)}}function ea(){var a=false;if("Prototype"in m){var b=parseFloat(m.Prototype.Version.substring(0,3));if(b>1.6||b==1.6&&parseInt(m.Prototype.Version.charAt(4))>=1)a=true}return a}function sa(){L()}function ga(){return"Sound"in m&&"SoundChannel"in m}function ia(){m.Sound.swfPath=C(s["soundjs-swf"]);L()}function fa(){return"swfobject"in m&&"embedSWF"in m.swfobject}function ja(){if(ga())ia();else new t(C(s.soundjs),ia);"WebSocket"in m||new t(C(s.fabridge),function(){new t(C(s.websocket),
ta)})}function ta(){m.WebSocket.__swfLocation=C(s["websocket-swf"]);m.WebSocket.__initialize();L()}function G(a,b){for(var d in b)a[d]=b[d];return a}function ka(a,b,d){d=a.slice((d||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,d)}function C(a){return a.substring(0,7)=="http://"||a.substring(0,8)=="https://"||a.substring(0,7)=="file://"?a:R+a}function z(a){a.prototype.initialize=a;a.subclasses=[]}function P(a,b){return function(){return a.apply(b,arguments)}}function r(a){return function(){return a}}
function S(a){return function(){return this[a]}}function T(){var a=arguments;m.console&&console.log&&console.log.apply(console,a);D.fireEvent("log",a)}function Q(a,b){return new i.game(a,$(b))}function ha(a){return Q(a,n.body)}var M=null,U=null,R=null,s={prototype:"lib/prototype.js",swfobject:"lib/swfobject.js",fabridge:"lib/FABridge.js",soundjs:"lib/Sound.min.js","soundjs-swf":"lib/Sound.swf",websocket:"lib/web_socket.js","websocket-swf":"lib/WebSocketMain.swf"},i={},N=navigator.userAgent,ua=Object.prototype.toString.call(m.opera)==
"[object Opera]",V=!!m.attachEvent&&!ua,va=V&&parseFloat(navigator.userAgent.split("MSIE")[1])<=7;N=N.indexOf("Gecko")>-1&&N.indexOf("KHTML")===-1;var j=function(){return n.documentElement.style.setProperty?function(a,b,d){a.style.setProperty(b,d,"important")}:function(a,b,d){a.style.cssText+=";"+b+":"+d+" !important;"}}(),la;la=m.CSSMatrix?function(a,b){a.style.transform="rotate("+(b||0)+"rad)";return a}:m.WebKitCSSMatrix?function(a,b){a.style.webkitTransform="rotate("+(b||0)+"rad)";return a}:N?
function(a,b){a.style.MozTransform="rotate("+(b||0)+"rad)";return a}:V?function(a,b){if(!a.a)a.a=[a.offsetWidth,a.offsetHeight];var d=Math.cos(b||0)*1,c=Math.sin(b||0)*1;try{var g=a.filters("DXImageTransform.Microsoft.Matrix");g.M11=d;g.M21=-c;g.M12=c;g.M22=d}catch(p){a.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',M11="+d+",M12="+-c+",M21="+c+",M22="+d+")"}a.style.marginLeft=(a.a[0]-a.offsetWidth)/2+"px";a.style.marginTop=(a.a[1]-a.offsetHeight)/2+"px";return a}:
function(a){return a};e.prototype.getElement=function(){var a=n.createElement("div");j(a,"position","absolute");j(a,"overflow","hidden");return function(){return a.cloneNode(false)}}();e.prototype.toElement=S("element");e.prototype.left=S("x");e.prototype.top=S("y");e.prototype.right=function(){return this.x+this.width-1};e.prototype.bottom=function(){return this.y+this.height-1};e.prototype.render=function(){if(this.__rotation!=this.rotation){la(this.element,this.rotation);this.__rotation=this.rotation}if(this.__opacity!=
this.opacity){Element.setOpacity(this.element,this.opacity);this.__opacity=this.opacity}if(this.__zIndex!=this.zIndex){this.__fixZIndex();this.__zIndex=this.zIndex}if(this.__width!=this.width){j(this.element,"width",this.width+"px");this.__width=this.width}if(this.__height!=this.height){j(this.element,"height",this.height+"px");this.__height=this.height}if(this.__x!=this.x){j(this.element,"left",this.x+"px");this.__x=this.x}if(this.__y!=this.y){this.__y=this.y;j(this.element,"top",this.y+"px")}};
e.prototype.update=function(){};e.prototype.__fixZIndex=function(){var a=this.parent&&this.parent.b?this.parent.b(this.zIndex):this.zIndex;j(this.element,"z-index",a)};e.prototype.width=10;e.prototype.height=10;e.prototype.x=0;e.prototype.y=0;e.prototype.opacity=1;e.prototype.rotation=0;e.prototype.zIndex=0;e.prototype.parent=null;e.prototype.element=null;e.prototype.toString=r("[object Component]");z(e);i.component=e;o.prototype=new e(true);o.prototype.update=function(a){if(this.__shouldUpdateComponents)for(var b=
0,d=null;b<this.components.length;b++){d=this.components[b];d.update&&d.update(a)}};o.prototype.render=function(a){e.prototype.render.call(this,a);this.__needsRender&&this.__renderComponents(a)};o.prototype.__renderComponents=function(a){for(var b=0,d=null;b<this.components.length;b++){d=this.components[b];d.render&&d.render(a)}};o.prototype.addComponent=function(a){if(a.parent!==this){a.parent&&a.parent.removeComponent(a);this.components.push(a);this.element.appendChild(a.element);a.parent=this;
a.__fixZIndex()}return this};o.prototype.removeComponent=function(a){var b=this.components.indexOf(a);if(b>-1){ka(this.components,b);this.element.removeChild(a.element);a.parent=null}return this};o.prototype.__computeChildZIndex=function(a){return(parseInt(this.element.style.zIndex)||0)+(parseInt(a)||0)};o.prototype.__fixZIndex=function(){e.prototype.__fixZIndex.call(this);for(var a=0;a<this.components.length;a++)this.components[a].__fixZIndex()};o.prototype.toString=r("[object Container]");z(o);
i.container=o;v.prototype=new o(true);v.prototype.addComponent=function(a){o.prototype.addComponent.call(this,a);this.__needsRender=true;return this};v.prototype.removeComponent=function(a){o.prototype.removeComponent.call(this,a);this.__needsRender=true;return this};v.prototype.render=function(a){if(this.width!=this.__width||this.height!=this.__height)this.__needsRender=true;o.prototype.render.call(this,a)};v.prototype.__renderComponents=function(a){o.prototype.__renderComponents.call(this,a);this.__needsRender=
false};v.prototype.renderComponents=function(){this.__needsRender=true};v.prototype.toString=r("[object DumbContainer]");z(v);i.dumbcontainer=v;q.prototype=new e(true);q.prototype.getElement=function(){var a=n.createElement("pre"),b={border:"none 0px #000000","background-color":"transparent",position:"absolute",overflow:"hidden",margin:"0px",padding:"0px"};for(var d in b)j(a,d,b[d]);return function(){var c=a.cloneNode(false);j(c,"color","#"+this.color);this._c=this.color;j(c,"font-family",this.font.__fontName);
this._f=this.font;j(c,"font-size",this.size+"px");j(c,"line-height",this.size+"px");this._s=this.size;return c}}();q.prototype.render=function(a){e.prototype.render.call(this,a);if(this.__align!==this.align){j(this.element,"text-align",this.align==0?"left":this.align==1?"center":"right");this.__align=this.align}if(this.__font!==this.font){j(this.element,"font-family",this.font.__fontName);this.__font=this.font}if(this.__size!==this.size){a=this.size+"px";j(this.element,"font-size",a);j(this.element,
"line-height",a);this.__size=this.size}if(this._c!==this.color){j(this.element,"color","#"+this.color);this._c=this.color}if(this._U){a="";for(var b=this._t.length,d=0,c=0,g,p;d<b;d++){g=this._t.charAt(d);if(g==="\n"){c=0;a+=g}else if(g==="\t"){g=q.TAB_WIDTH-c%q.TAB_WIDTH;for(p=0;p<g;p++)a+=" ";c+=g}else{a+=g;c++}}if(va)a=a.replace(/\n/g,"\r");this._n.nodeValue=a;this._U=false}};q.prototype.getText=function(){return this._t};q.prototype.setText=function(a){this._t=a;this._U=true};q.prototype.align=
0;q.prototype.color="FFFFFF";q.prototype.font=new F("monospace");q.prototype.size=12;q.prototype.toString=r("[object Label]");G(q,{LEFT:0,CENTER:1,RIGHT:2,TAB_WIDTH:4});z(q);i.label=q;w.prototype=new e(true);w.prototype.getElement=function(){var a=e.prototype.getElement.call(this);a.appendChild(this.spritesetImg);return a};w.prototype.render=function(a){var b=this;if(b.__spriteX!=b.spriteX||b.__spriteY!=b.spriteY||b.__width!=b.width||b.__height!=b.height)if(b.spriteset.loaded)b.resetSpriteset();else if(!b.__resetOnLoad){b.spriteset.addListener("load",
function(){b.resetSpriteset()});b.__resetOnLoad=true}e.prototype.render.call(b,a)};w.prototype.resetSpriteset=function(){var a=this.spritesetImg;j(a,"width",this.spriteset.width*(this.width/this.spriteset.spriteWidth)+"px");j(a,"height",this.spriteset.height*(this.height/this.spriteset.spriteHeight)+"px");j(a,"top",-(this.height*this.spriteY)+"px");j(a,"left",-(this.width*this.spriteX)+"px");this.__spriteX=this.spriteX;this.__spriteY=this.spriteY};w.prototype.spriteX=0;w.prototype.spriteY=0;w.prototype.toString=
r("[object Sprite]");z(w);i.sprite=w;A.prototype=new e(true);A.prototype.render=function(a){if(this.__color!==this.color){j(this.element,"background-color","#"+this.color);this.__color=this.color}e.prototype.render.call(this,a)};A.prototype.color="000000";A.prototype.toString=r("[object Shape]");z(A);i.shape=A;E.prototype=new A(true);E.prototype.getElement=function(){this.__color=this.color;var a=new Element("div");j(a,"position","absolute");j(a,"background-color","#"+this.color);return a};E.prototype.toString=
r("[object Rectangle]");z(E);i.rectangle=E;h.prototype.addListener=function(a,b){var d=this._l;a in d||(d[a]=[]);d[a].push(b);return this};h.prototype.removeListener=function(a,b){var d=this._l[a];if(d){var c=d.indexOf(b);c>=0&&ka(d,c)}return this};h.prototype.removeAllListeners=function(a){delete this._l[a];return this};h.prototype.fireEvent=function(a,b){var d=this._l[a],c=0;if(d)for(var g=d.length;c<g;c++)d[c].apply(this,b);return this};var ma=false;h.prototype.observe=function(){if(!ma){T("DEPRECATED: 'EventEmitter#observe' is deprecated, please use 'EventEmitter#addListener' instead.");
ma=true}return this.addListener.apply(this,arguments)};var na=false;h.prototype.stopObserving=function(){if(!na){T("DEPRECATED: 'EventEmitter#stopObserving' is deprecated, please use 'EventEmitter#removeListener' instead.");na=true}return this.removeListener.apply(this,arguments)};i.eventemitter=h;function B(a){var b=this;h.call(b);b._bind=function(d){var c=d.style;c.padding=0;c.overflow="hidden";if(c.MozUserSelect!==undefined)c.MozUserSelect="moz-none";else if(c.webkitUserSelect!==undefined)c.webkitUserSelect=
"none";Element.makePositioned(d);Element.immediateDescendants(d).without($("webSocketContainer")).invoke("remove");b.element!==null&&Object.isElement(b.element)&&Element.immediateDescendants(b.element).invoke("remove").each(d.insert,d);b.element=d;a.element=d;b.isFullScreen=d===n.body};b.useNativeCursor=function(d){var c=null;if(Boolean(d)==false)d="none";if(Object.isString(d)){d=d.toLowerCase();if("default"==d)c="default";else if("crosshair"==d)c="crosshair";else if("hand"==d)c="pointer";else if("move"==
d)c="move";else if("text"==d)c="text";else if("wait"==d)c="wait";else if("none"==d)c="url("+R+"blank."+(V?"cur":"gif")+"), none"}b.element.style.cursor=c}}B.prototype=new h(true);B.prototype._r=function(){color=this.color;element=this.element;this.width=this.isFullScreen&&n.documentElement.clientWidth!==0?n.documentElement.clientWidth:this.element.clientWidth;this.height=this.isFullScreen&&n.documentElement.clientHeight!==0?n.documentElement.clientHeight:this.element.clientHeight;if(color!=this._c){element.style.backgroundColor=
"#"+color;this._c=color}};B.prototype.color="000000";B.prototype.isFullScreen=false;B.prototype.toString=r("[object Screen]");i.screen=B;var f=null;k.prototype=new h(true);k.prototype.pointerX=0;k.prototype.pointerY=0;k.prototype.isKeyDown=function(a){return this._k[a]===true};k.prototype.toString=r("[object Input]");k.MOUSE_PRIMARY=0;k.MOUSE_MIDDLE=1;k.MOUSE_SECONDARY=2;k.KEY_DOWN=40;k.KEY_UP=38;k.KEY_LEFT=37;k.KEY_RIGHT=39;k.KEY_1=32;k.KEY_2=33;k.KEY_3=34;k.KEY_4=35;k.grab=function(){n.observe("keydown",
Y).observe("keypress",X).observe("keyup",Z).observe("mousemove",ba).observe("mousedown",I).observe("mouseup",aa).observe("contextmenu",W);k.c=true};k.release=function(){n.stopObserving("keydown",Y).stopObserving("keypress",X).stopObserving("keyup",Z).stopObserving("mousemove",ba).stopObserving("mousedown",I).stopObserving("mouseup",aa).stopObserving("contextmenu",W);k.c=false};i.input=k;var oa=function(){return"now"in Date?Date.now:function(){return(new Date).getTime()}}(),K=null,J=[];l.prototype=
new o(true);l.prototype.gameSpeed=30;l.prototype.maxFrameSkips=5;l.prototype.renderCount=0;l.prototype.updateCount=0;l.prototype.setGameSpeed=function(a){this.gameSpeed=a;this.period=1E3/a;return this};l.prototype.start=function(){this.running=true;J.push(this);this.startTime=this.nextGamePeriod=oa();this.updateCount=this.renderCount=0;setTimeout(this._s,0);this.fireEvent("start")};l.prototype.getFont=function(a,b){return new i.font(this,a,b)};l.prototype.getScript=function(a,b){return new i.script(this,
a,b)};l.prototype.getSound=function(a,b){return new i.sound(this,a,b)};l.prototype.getSpriteset=function(a,b,d,c){return new i.spriteset(this,a,b,d,c)};l.prototype.render=function(){for(var a=0,b=null,d=this.renderCount++;a<this.components.length;a++){b=this.components[a];b.render&&b.render(d)}};l.prototype.step=function(){if(!this.running)return this.stopped();K=this;for(var a=0;oa()>this.nextGamePeriod&&a<this.maxFrameSkips;){this.update();this.nextGamePeriod+=this.period;a++}this.screen._r();this.render();
setTimeout(this._s,0)};l.prototype.stop=function(){this.fireEvent("stopping");this.running=false;return this};l.prototype.stopped=function(){this.screen.useNativeCursor(true);K=null;this.fireEvent("stopped")};l.prototype.update=function(){for(var a=0,b=null,d=this.updateCount++;a<this.components.length;a++){b=this.components[a];b.update&&b.update(d)}};l.prototype.__computeChildZIndex=function(a){return((parseInt(a)||0)+1)*1E3};l.prototype.toString=r("[object Game]");l.getInstance=function(){return K};
z(l);i.game=l;F.prototype=new h(true);F.prototype.toString=r("[object Font]");F.subclasses=[];i.font=F;t.subclasses=[];t.prototype=new h(true);t.prototype.loaded=false;t.prototype.toString=r("[object Script]");t.destroyScript=function(a){a.parentNode&&a.parentNode.removeChild(a);for(var b in a)delete a[b];return a};i.script=t;function O(){h.call(this)}O.subclasses=[];O.prototype=new h(true);O.prototype.toString=r("[object Sound]");i.sound=O;u.subclasses=[];u.prototype=new h(true);u.prototype.loaded=
false;u.prototype.width=-1;u.prototype.height=-1;u.prototype.spriteWidth=-1;u.prototype.spriteHeight=-1;u.prototype.src=null;u.prototype.toElement=function(){return this.image.cloneNode(true)};u.prototype.toString=r("[object Spriteset]");i.spriteset=u;y.prototype=new h(true);y.prototype.connect=function(){var a=new WebSocket(this.URL);a.onopen=this._O;a.onclose=this._C;a.onmessage=this._M;this._w=a};y.prototype.close=function(){this._w&&this._w.close()};y.prototype.send=function(a){this._w.send(a)};
y.prototype.autoconnect=false;y.prototype.toString=r("[object Client]");G(y,{CONNECTING:0,OPEN:1,CLOSED:2});i.client=y;ca.canServe=false;i.server=ca;var D=new h;D.toString=function(){return"[object SGF]"};m.SGF=D;D.log=T;D.require=function(a){if(typeof a=="string"){a=String(a).toLowerCase();if(a in i)return i[a];throw Error("SGF.require: module name '"+a+"' does not exist");}throw Error("SGF.require: expected argument typeof 'string', got '"+typeof a+"'");};D.startWithDiv=Q;D.startFullScreen=ha;da(function(a){M=
a;R=M.substring(0,M.lastIndexOf("/")+1);a:{a=M;var b=n.getElementsByTagName("script"),d=b.length,c=n.getElementById("SGF-script");if(c)U=c;else{for(;d--;){c=b[d];if(c.src===a){U=c;break a}}throw Error('FATAL: Could not find <script> node with "src" === "'+a+'"\nPlease report this to the SGF issue tracker. You can work around this error by explicitly setting the "id" of the <script> node to "SGF-script".');}}a=U;for(b=a.attributes.length;b--;){d=a.attributes[b].nodeName;if(d.indexOf("data-")===0)s[d.substring(5)]=
a.getAttribute(d)}if(ea())L();else new t(C(s.prototype),sa);if(fa())ja();else new t(C(s.swfobject),ja)})})(this,document);