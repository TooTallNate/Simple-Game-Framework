(function(m,n){function e(a){H(this,a||{});this.element=this.getElement()}function p(a,b){this.components=[];e.call(this,b||{});Object.isArray(a)&&a.each(this.addComponent,this);this.__shouldUpdateComponents=this.__needsRender=true}function y(a,b){p.call(this,a,b);this.__shouldUpdateComponents=this.__needsRender=false}function r(a){e.call(this,a);this._t="";this._n=n.createTextNode(this._t);this.element.appendChild(this._n)}function z(a,b){this.spriteset=a;this.spritesetImg=a.image.cloneNode(false);
e.call(this,b)}function C(a){e.call(this,a)}function F(a){e.call(this,a)}function g(){this._l={};if(!(this instanceof g))for(var a in g.prototype)this[a]=g.prototype[a]}function k(a){g.call(this);this.game=a;this._k={}}function I(a){var b=f.game.screen.element.cumulativeOffset();return{x:a.pointerX()-b.left,y:a.pointerY()-b.top}}function X(a){if(f){var b=I(a),c=f.game.screen;b.x>=0&&b.y>=0&&b.x<=c.width&&b.y<=c.height&&a.stop()}}function Y(a){a.ctrlKey||a.metaKey||a.altKey||f&&a.stop()}function Z(a){if(!(a.ctrlKey||
a.metaKey||a.altKey))if(f){a.stop();if(f._k[a.keyCode]!==true){var b={keyCode:a.keyCode,shiftKey:a.shiftKey};f._k[a.keyCode]=true;f.emit("keydown",[b])}}}function aa(a){if(!(a.ctrlKey||a.metaKey||a.altKey))if(f){a.stop();if(f._k[a.keyCode]!==false){var b={keyCode:a.keyCode,shiftKey:a.shiftKey};f._k[a.keyCode]=false;f.emit("keydown",[b])}}}function J(a){if(f){var b=I(a),c=f.game.screen;b.button=a.button;if(b.x>=0&&b.y>=0&&b.x<=c.width&&b.y<=c.height){f=f;a.stop();m.focus();f.pointerX=b.x;f.pointerY=
b.y;f.emit("mousedown",[b])}else{f=null;J(a)}}else{b=K.length;for(var d=c=null,h=a.pointerX(),o=a.pointerY();b--;){d=K[b].screen.element;c=d.cumulativeOffset();if(h>=c.left&&h<=c.left+d.clientWidth&&o>=c.top&&o<=c.top+d.clientHeight){f=K[b].input;J(a)}}}}function ba(a){if(f){var b=I(a),c=f.game.screen;b.button=a.button;if(b.x>=0&&b.y>=0&&b.x<=c.width&&b.y<=c.height){a.stop();f.pointerX=b.x;f.pointerY=b.y;f.emit("mouseup",[b])}}}function ca(a){if(f){var b=I(a),c=f.game.screen;if(b.x>=0&&b.y>=0&&b.x<=
c.width&&b.y<=c.height&&(f.pointerX!==b.x||f.pointerY!==b.y)){a.stop();f.pointerX=b.x;f.pointerY=b.y;f.emit("mousemove",[b])}}}function l(a,b,c){var d=this;g.call(d);p.call(d,c);d.input=new k(d);d.screen=new D(d);d.screen._bind(b);if(a.endsWith("main.js"))a=a.substring(0,a.lastIndexOf("main.js"));d.root=a.endsWith("/")?a:a+"/";d.setGameSpeed(d.gameSpeed);d.loaded=d.running=false;d.startTime=NaN;L=d;d._s=function(){d.step()};new v(d,"main.js",function(){d.loaded=true;d.emit("load");d.start()})}function G(a,
b){g.call(this);if(a instanceof l){b=a.root+b;this.__fontName="SGF_font"+(Math.random()*1E4).round();var c='@font-face {  font-family: "'+this.__fontName+'";  src: url("'+b+'");}',d=n.createElement("style");d.type="text/css";if(d.styleSheet)d.styleSheet.cssText=c;else d.appendChild(n.createTextNode(c));n.getElementsByTagName("head")[0].appendChild(d);this.__styleNode=d}else this.__fontName=b=a}function v(a,b,c){if(a instanceof l)b=a.root+b;else{c=b;b=a}var d=n.createElement("script"),h=this;g.call(h);
c&&h.addListener("load",c);d.type="text/javascript";d.setAttribute("async","true");d.onload=d.onreadystatechange=function(){if(!d.readyState||d.readyState=="loaded"||d.readyState=="complete"){h.loaded=true;h.emit("load")}};h.self=d.src=b;n.getElementsByTagName("head")[0].appendChild(d)}function w(a,b,c,d,h){var o=this;g.call(o);o.spriteWidth=c;o.spriteHeight=d;h&&o.addListener("load",h);var x=new Image;x.style.position="absolute";x.onload=function(){o.width=x.width;o.height=x.height;o.loaded=true;
o.emit("load")};o.image=x;o.src=x.src=a.root+b}function A(a,b){g.call(this);H(this,b||{});this.URL=a;this._O=S(qa,this);this._C=S(ra,this);this._M=S(sa,this);this.autoconnect&&this.connect()}function qa(){this.emit("open")}function ra(){this.emit("close");this._w=null}function sa(a){this.emit("message",a.data)}function da(){throw Error("The HTML game engine is not capable of starting a `Server`.");}function M(){var a=arguments;m.console&&console.log&&Function.prototype.apply.call(console.log,console,
a);B.emit("log",a)}function s(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}function T(a,b){return new j.game(a,$(b))}function ea(a){return T(a,n.body)}function N(){if(fa()&&ga()&&ha()&&"WebSocket"in m){k.grab();if(t.game)t.screen?T(t.game,t.screen):ea(t.game)}}function fa(){var a=false;if("Prototype"in m){var b=parseFloat(m.Prototype.Version.substring(0,3));if(b>1.6||b==1.6&&parseInt(m.Prototype.Version.charAt(4))>=1)a=true}return a}function ta(){N()}function ha(){return"Sound"in
m&&"SoundChannel"in m}function ia(){m.Sound.swfPath=E(t["soundjs-swf"]);N()}function ga(){return"swfobject"in m&&"embedSWF"in m.swfobject}function ja(){if(ha())ia();else new v(E(t.soundjs),ia);"WebSocket"in m||new v(E(t.fabridge),function(){new v(E(t.websocket),ua)})}function ua(){m.WebSocket.__swfLocation=E(t["websocket-swf"]);m.WebSocket.__initialize();N()}function H(a,b){for(var c in b)a[c]=b[c];return a}function ka(a,b,c){c=a.slice((c||b)+1||a.length);a.length=b<0?a.length+b:b;return a.push.apply(a,
c)}function E(a){return a.substring(0,7)=="http://"||a.substring(0,8)=="https://"||a.substring(0,7)=="file://"?a:U+a}function u(a){a.prototype.initialize=a;a.subclasses=[]}function S(a,b){return function(){return a.apply(b,arguments)}}function q(a){return function(){return a}}function V(a){return function(){return this[a]}}var O=null,W=null,U=null;n.createElement("canvas").getContext&&n.createElement("canvas").getContext("2d");var t={prototype:"lib/prototype.js",swfobject:"lib/swfobject.js",fabridge:"lib/FABridge.js",
soundjs:"lib/Sound.min.js","soundjs-swf":"lib/Sound.swf",websocket:"lib/web_socket.js","websocket-swf":"lib/WebSocketMain.swf"},j={},P=navigator.userAgent,va=Object.prototype.toString.call(m.opera)=="[object Opera]",Q=!!m.attachEvent&&!va,wa=Q&&parseFloat(navigator.userAgent.split("MSIE")[1])<=7;P=P.indexOf("Gecko")>-1&&P.indexOf("KHTML")===-1;var i;i=!Q&&n.documentElement.style.setProperty?function(a,b,c){a.style.setProperty(b,c,"important")}:function(a,b,c){a.style.cssText+=";"+b+":"+c+" !important;"};
var la;la=m.CSSMatrix?function(a,b){a.style.transform="rotate("+(b||0)+"rad)";return a}:m.WebKitCSSMatrix?function(a,b){a.style.webkitTransform="rotate("+(b||0)+"rad)";return a}:P?function(a,b){a.style.MozTransform="rotate("+(b||0)+"rad)";return a}:Q?function(a,b){if(!a.a)a.a=[a.offsetWidth,a.offsetHeight];var c=Math.cos(b||0)*1,d=Math.sin(b||0)*1;try{var h=a.filters("DXImageTransform.Microsoft.Matrix");h.M11=c;h.M21=-d;h.M12=d;h.M22=c}catch(o){a.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',M11="+
c+",M12="+-d+",M21="+d+",M22="+c+")"}a.style.marginLeft=(a.a[0]-a.offsetWidth)/2+"px";a.style.marginTop=(a.a[1]-a.offsetHeight)/2+"px";return a}:function(a){return a};e.prototype.getElement=function(){var a=n.createElement("div");i(a,"position","absolute");i(a,"overflow","hidden");return function(){return a.cloneNode(false)}}();e.prototype.toElement=V("element");e.prototype.left=V("x");e.prototype.top=V("y");e.prototype.right=function(){return this.x+this.width-1};e.prototype.bottom=function(){return this.y+
this.height-1};e.prototype.render=function(){if(this.__rotation!=this.rotation){la(this.element,this.rotation);this.__rotation=this.rotation}if(this.__opacity!=this.opacity){Element.setOpacity(this.element,this.opacity);this.__opacity=this.opacity}if(this.__zIndex!=this.zIndex){this.__fixZIndex();this.__zIndex=this.zIndex}if(this.__width!=this.width){i(this.element,"width",this.width+"px");this.__width=this.width}if(this.__height!=this.height){i(this.element,"height",this.height+"px");this.__height=
this.height}if(this.__x!=this.x){i(this.element,"left",this.x+"px");this.__x=this.x}if(this.__y!=this.y){this.__y=this.y;i(this.element,"top",this.y+"px")}};e.prototype.update=function(){};e.prototype.__fixZIndex=function(){var a=this.parent&&this.parent.b?this.parent.b(this.zIndex):this.zIndex;i(this.element,"z-index",a)};e.prototype.width=10;e.prototype.height=10;e.prototype.x=0;e.prototype.y=0;e.prototype.opacity=1;e.prototype.rotation=0;e.prototype.zIndex=0;e.prototype.parent=null;e.prototype.element=
null;e.prototype.toString=q("[object Component]");u(e);j.component=e;s(p,e);u(p);p.prototype.update=function(a){if(this.__shouldUpdateComponents)for(var b=0,c=null;b<this.components.length;b++){c=this.components[b];c.update&&c.update(a)}};p.prototype.render=function(a){e.prototype.render.call(this,a);this.__needsRender&&this.__renderComponents(a)};p.prototype.__renderComponents=function(a){for(var b=0,c=null;b<this.components.length;b++){c=this.components[b];c.render&&c.render(a)}};p.prototype.addComponent=
function(a){if(a.parent!==this){a.parent&&a.parent.removeComponent(a);this.components.push(a);this.element.appendChild(a.element);a.parent=this;a.__fixZIndex()}return this};p.prototype.removeComponent=function(a){var b=this.components.indexOf(a);if(b>-1){ka(this.components,b);this.element.removeChild(a.element);a.parent=null}return this};p.prototype.__computeChildZIndex=function(a){return(parseInt(this.element.style.zIndex)||0)+(parseInt(a)||0)};p.prototype.__fixZIndex=function(){e.prototype.__fixZIndex.call(this);
for(var a=0;a<this.components.length;a++)this.components[a].__fixZIndex()};p.prototype.toString=q("[object Container]");j.container=p;s(y,p);u(y);y.prototype.addComponent=function(a){p.prototype.addComponent.call(this,a);this.__needsRender=true;return this};y.prototype.removeComponent=function(a){p.prototype.removeComponent.call(this,a);this.__needsRender=true;return this};y.prototype.render=function(a){if(this.width!=this.__width||this.height!=this.__height)this.__needsRender=true;p.prototype.render.call(this,
a)};y.prototype.__renderComponents=function(a){p.prototype.__renderComponents.call(this,a);this.__needsRender=false};y.prototype.renderComponents=function(){this.__needsRender=true};y.prototype.toString=q("[object DumbContainer]");j.dumbcontainer=y;s(r,e);u(r);r.prototype.getElement=function(){var a=n.createElement("pre"),b={border:"none 0px #000000","background-color":"transparent",position:"absolute",overflow:"hidden",margin:"0px",padding:"0px"};for(var c in b)i(a,c,b[c]);return function(){var d=
a.cloneNode(false);i(d,"color","#"+this.color);this._c=this.color;i(d,"font-family",this.font.__fontName);this._f=this.font;i(d,"font-size",this.size+"px");i(d,"line-height",this.size+"px");this._s=this.size;return d}}();r.prototype.render=function(a){e.prototype.render.call(this,a);if(this.__align!==this.align){i(this.element,"text-align",this.align==0?"left":this.align==1?"center":"right");this.__align=this.align}if(this.__font!==this.font){i(this.element,"font-family",this.font.__fontName);this.__font=
this.font}if(this.__size!==this.size){a=this.size+"px";i(this.element,"font-size",a);i(this.element,"line-height",a);this.__size=this.size}if(this._c!==this.color){i(this.element,"color","#"+this.color);this._c=this.color}if(this._U){a="";for(var b=this._t.length,c=0,d=0,h,o;c<b;c++){h=this._t.charAt(c);if(h==="\n"){d=0;a+=h}else if(h==="\t"){h=r.TAB_WIDTH-d%r.TAB_WIDTH;for(o=0;o<h;o++)a+=" ";d+=h}else{a+=h;d++}}if(wa)a=a.replace(/\n/g,"\r");this._n.nodeValue=a;this._U=false}};r.prototype.getText=
function(){return this._t};r.prototype.setText=function(a){this._t=a;this._U=true};r.prototype.align=0;r.prototype.color="FFFFFF";r.prototype.font=new G("monospace");r.prototype.size=12;r.prototype.toString=q("[object Label]");H(r,{LEFT:0,CENTER:1,RIGHT:2,TAB_WIDTH:4});j.label=r;s(z,e);u(z);z.prototype.getElement=function(){var a=e.prototype.getElement.call(this);a.appendChild(this.spritesetImg);return a};z.prototype.render=function(a){var b=this;if(b.__spriteX!=b.spriteX||b.__spriteY!=b.spriteY||
b.__width!=b.width||b.__height!=b.height)if(b.spriteset.loaded)b.resetSpriteset();else if(!b.__resetOnLoad){b.spriteset.addListener("load",function(){b.resetSpriteset()});b.__resetOnLoad=true}e.prototype.render.call(b,a)};z.prototype.resetSpriteset=function(){var a=this.spritesetImg;i(a,"width",this.spriteset.width*(this.width/this.spriteset.spriteWidth)+"px");i(a,"height",this.spriteset.height*(this.height/this.spriteset.spriteHeight)+"px");i(a,"top",-(this.height*this.spriteY)+"px");i(a,"left",
-(this.width*this.spriteX)+"px");this.__spriteX=this.spriteX;this.__spriteY=this.spriteY};z.prototype.spriteX=0;z.prototype.spriteY=0;z.prototype.toString=q("[object Sprite]");j.sprite=z;s(C,e);u(C);C.prototype.render=function(a){if(this.__color!==this.color){i(this.element,"background-color","#"+this.color);this.__color=this.color}e.prototype.render.call(this,a)};C.prototype.color="000000";C.prototype.toString=q("[object Shape]");j.shape=C;s(F,C);u(F);F.prototype.getElement=function(){this.__color=
this.color;var a=new Element("div");i(a,"position","absolute");i(a,"background-color","#"+this.color);return a};F.prototype.toString=q("[object Rectangle]");j.rectangle=F;g.prototype.addListener=function(a,b){var c=this._l;if(typeof b!="function")throw Error("EventEmitter#addListener expects a Function as a second argument");if(a in c)c[a].push(b);else c[a]=[b];return this};g.prototype.removeListener=function(a,b){var c=this._l[a];if(c){var d=c.indexOf(b);d>=0&&ka(c,d)}return this};g.prototype.removeAllListeners=
function(a){delete this._l[a];return this};g.prototype.emit=function(a,b){var c=this._l[a],d=0;b=b||[];if(c)for(;d<c.length;d++)c[d].apply(this,b);return this};var ma=false;g.prototype.fireEvent=function(){if(!ma){M("DEPRECATED: 'EventEmitter#fireEvent' is deprecated, please use 'EventEmitter#emit' instead.");ma=true}return this.emit.apply(this,arguments)};var na=false;g.prototype.observe=function(){if(!na){M("DEPRECATED: 'EventEmitter#observe' is deprecated, please use 'EventEmitter#addListener' instead.");
na=true}return this.addListener.apply(this,arguments)};var oa=false;g.prototype.stopObserving=function(){if(!oa){M("DEPRECATED: 'EventEmitter#stopObserving' is deprecated, please use 'EventEmitter#removeListener' instead.");oa=true}return this.removeListener.apply(this,arguments)};j.eventemitter=g;function D(a){var b=this;g.call(b);b._bind=function(c){var d=c.style;d.padding=0;d.overflow="hidden";if(d.MozUserSelect!==undefined)d.MozUserSelect="moz-none";else if(d.webkitUserSelect!==undefined)d.webkitUserSelect=
"none";Element.makePositioned(c);Element.immediateDescendants(c).without($("webSocketContainer")).invoke("remove");b.element!==null&&Object.isElement(b.element)&&Element.immediateDescendants(b.element).invoke("remove").each(c.insert,c);b.element=c;a.element=c;b.isFullScreen=c===n.body};b.useNativeCursor=function(c){var d=null;if(Boolean(c)==false)c="none";if(Object.isString(c)){c=c.toLowerCase();if("default"==c)d="default";else if("crosshair"==c)d="crosshair";else if("hand"==c)d="pointer";else if("move"==
c)d="move";else if("text"==c)d="text";else if("wait"==c)d="wait";else if("none"==c)d="url("+U+"blank."+(Q?"cur":"gif")+"), none"}b.element.style.cursor=d}}s(D,g);D.prototype._r=function(){color=this.color;element=this.element;this.width=this.isFullScreen&&n.documentElement.clientWidth!==0?n.documentElement.clientWidth:this.element.clientWidth;this.height=this.isFullScreen&&n.documentElement.clientHeight!==0?n.documentElement.clientHeight:this.element.clientHeight;if(color!=this._c){element.style.backgroundColor=
"#"+color;this._c=color}};D.prototype.color="000000";D.prototype.isFullScreen=false;D.prototype.toString=q("[object Screen]");j.screen=D;var f=null;s(k,g);k.prototype.pointerX=0;k.prototype.pointerY=0;k.prototype.isKeyDown=function(a){return this._k[a]===true};k.prototype.toString=q("[object Input]");k.MOUSE_PRIMARY=0;k.MOUSE_MIDDLE=1;k.MOUSE_SECONDARY=2;k.KEY_DOWN=40;k.KEY_UP=38;k.KEY_LEFT=37;k.KEY_RIGHT=39;k.KEY_1=32;k.KEY_2=33;k.KEY_3=34;k.KEY_4=35;k.grab=function(){n.observe("keydown",Z).observe("keypress",
Y).observe("keyup",aa).observe("mousemove",ca).observe("mousedown",J).observe("mouseup",ba).observe("contextmenu",X);k.c=true};k.release=function(){n.stopObserving("keydown",Z).stopObserving("keypress",Y).stopObserving("keyup",aa).stopObserving("mousemove",ca).stopObserving("mousedown",J).stopObserving("mouseup",ba).stopObserving("contextmenu",X);k.c=false};j.input=k;var pa=function(){return"now"in Date?Date.now:function(){return(new Date).getTime()}}(),L=null,K=[];s(l,p);u(l);l.prototype.gameSpeed=
30;l.prototype.maxFrameSkips=5;l.prototype.renderCount=0;l.prototype.updateCount=0;l.prototype.setGameSpeed=function(a){this.gameSpeed=a;this.period=1E3/a;return this};l.prototype.start=function(){this.running=true;K.push(this);this.startTime=this.nextGamePeriod=pa();this.updateCount=this.renderCount=0;setTimeout(this._s,0);this.emit("start")};l.prototype.getFont=function(a,b){return new j.font(this,a,b)};l.prototype.getScript=function(a,b){return new j.script(this,a,b)};l.prototype.getSound=function(a,
b){return new j.sound(this,a,b)};l.prototype.getSpriteset=function(a,b,c,d){return new j.spriteset(this,a,b,c,d)};l.prototype.render=function(){for(var a=0,b=null,c=this.renderCount++;a<this.components.length;a++){b=this.components[a];b.render&&b.render(c)}};l.prototype.step=function(){if(!this.running)return this.stopped();L=this;for(var a=0;pa()>this.nextGamePeriod&&a<this.maxFrameSkips;){this.update();this.nextGamePeriod+=this.period;a++}this.screen._r();this.render();setTimeout(this._s,0)};l.prototype.stop=
function(){this.emit("stopping");this.running=false;return this};l.prototype.stopped=function(){this.screen.useNativeCursor(true);L=null;this.emit("stopped")};l.prototype.update=function(){for(var a=0,b=null,c=this.updateCount++;a<this.components.length;a++){b=this.components[a];b.update&&b.update(c)}};l.prototype.__computeChildZIndex=function(a){return((parseInt(a)||0)+1)*1E3};l.prototype.toString=q("[object Game]");l.getInstance=function(){return L};j.game=l;s(G,g);u(G);G.prototype.toString=q("[object Font]");
j.font=G;s(v,g);u(v);v.prototype.loaded=false;v.prototype.toString=q("[object Script]");v.destroyScript=function(a){a.parentNode&&a.parentNode.removeChild(a);for(var b in a)delete a[b];return a};j.script=v;function R(){g.call(this)}s(R,g);u(R);R.prototype.toString=q("[object Sound]");j.sound=R;s(w,g);u(w);w.prototype.loaded=false;w.prototype.width=-1;w.prototype.height=-1;w.prototype.spriteWidth=-1;w.prototype.spriteHeight=-1;w.prototype.src=null;w.prototype.toElement=function(){return this.image.cloneNode(true)};
w.prototype.toString=q("[object Spriteset]");j.spriteset=w;s(A,g);u(A);A.prototype.connect=function(){var a=new WebSocket(this.URL);a.onopen=this._O;a.onclose=this._C;a.onmessage=this._M;this._w=a};A.prototype.close=function(){this._w&&this._w.close()};A.prototype.send=function(a){this._w.send(a)};A.prototype.autoconnect=false;A.prototype.toString=q("[object Client]");H(A,{CONNECTING:0,OPEN:1,CLOSED:2});j.client=A;da.canServe=false;j.server=da;var B=new g;B.toString=q("[object SGF]");m.SGF=B;B.log=
M;B.inherits=s;B.require=function(a){if(typeof a=="string"){a=String(a).toLowerCase();if(a in j)return j[a];throw Error("SGF.require: module name '"+a+"' does not exist");}throw Error("SGF.require: expected argument typeof 'string', got '"+typeof a+"'");};B.startWithDiv=T;B.startFullScreen=ea;(function(a){try{0()}catch(b){if(b.fileName)a(b.fileName);else if(b.sourceURL)a(b.sourceURL);else if(b.arguments){var c=Error.prepareStackTrace;Error.prepareStackTrace=function(o,x){return x[1].getFileName()};
var d=b.stack;Error.prepareStackTrace=c;a(d)}else if(b.stack){c=b.stack;c=c.split("\n")[0];c=c.substring(c.indexOf("@")+1);a(c.substring(0,c.lastIndexOf(":")))}else{var h=m.onerror;m.onerror=function(o,x){m.onerror=h;a(x);return true};throw b;}}})(function(a){O=a;U=O.substring(0,O.lastIndexOf("/")+1);a:{a=O;var b=n.getElementsByTagName("script"),c=b.length,d=n.getElementById("SGF-script");if(d)W=d;else{for(;c--;){d=b[c];if(d.src===a){W=d;break a}}throw Error('FATAL: Could not find <script> node with "src" === "'+
a+'"\nPlease report this to the SGF issue tracker. You can work around this error by explicitly setting the "id" of the <script> node to "SGF-script".');}}a=W;for(b=a.attributes.length;b--;){c=a.attributes[b].nodeName;if(c.indexOf("data-")===0)t[c.substring(5)]=a.getAttribute(c)}if(fa())N();else new v(E(t.prototype),ta);if(ga())ja();else new v(E(t.swfobject),ja)})})(this,document);